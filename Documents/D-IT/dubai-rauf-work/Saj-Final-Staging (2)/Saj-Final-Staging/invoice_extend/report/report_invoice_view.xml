<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
    
        <template id="report_invoice_document" inherit_id="account.report_invoice_document">
            <xpath expr="//t[@t-call='web.external_layout']" position="replace">
                <div class="article" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id" t-att-data-oe-lang="o and o.env.context.get('lang')">
                <t t-set="o" t-value="o.with_context(lang=o.partner_id.lang)"/>
                
                <div class="header">
                    <div class="col-auto col-6">
                        <img src='/invoice_extend/static/img/header.png' style="max-height: 170px; max-width: 920px;"/>
                    </div>
                    <div class="col-auto col-12">
                        <h1 class="text-center" style="color:red;">
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'posted'">TAX INVOICE</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'draft'">PROFORMA INVOICE</span>
                            <span t-if="o.move_type == 'out_invoice' and o.state == 'cancel'">CANCELLED INVOICE</span>
                            <span t-if="o.move_type == 'out_refund'">CREDIT NOTE</span>
                            <span t-if="o.move_type == 'in_refund'">CREDIT VENDOR NOTE</span>
                            <span t-if="o.move_type == 'in_invoice'">VENDOR BILL</span>
                        </h1>
                    </div>
                 </div>
             
                <div class="page">
                    <div style="width: 920px;">
                        <div class="border-black" style="border-bottom: 10px solid red; margin-top:10px;"></div>
                    </div>
                    
                    <table style="width: 920px; margin-top:10px;">
                        <tr>
                            <td colspan="2"><b>Customer Name</b></td>
                            <td colspan="2"><span t-field="o.partner_id.street"/></td>
                            <td colspan="3" rowspan="4"></td>
                            <td><b>Date</b></td>
                            <td colspan="2"><span t-field="o.invoice_date"/></td>
                        </tr>
                        <tr>
                            <td colspan="2"><b>Customer TRN# </b></td>
                            <td colspan="2"><span t-field="o.partner_id.vat"/></td>
                            <td><b>Invoice# </b></td>
                            <td colspan="2"><span t-field="o.name"/></td>
                        </tr>
                        <tr>
                            <td colspan="2"><b>Customer Phone</b></td>
                            <td colspan="2"><span t-field="o.partner_id.phone"/></td>
                            <td><b>TRN#</b></td>
                            <td colspan="2"><span t-field="o.company_id.vat"/></td>
                        </tr>
                        <tr>
                            <td colspan="2"><b>VIN</b></td>
                            <td colspan="2"><span t-field="o.car_history_id.vin_number"/></td>
                            <td><b>Advisor</b></td>
                            <td colspan="2"><span t-field="o.invoice_user_id.name"/></td>
                        </tr>
                        <tr>
                            <td><b>Year</b></td>
                            <td style="width: 110px;"><span t-field="o.car_history_id.year"/></td>
                            <td><b>Make</b></td>
                            <td style="width: 110px;"><span t-field="o.car_history_id.car_brand_id.name"/></td>
                            <td><b>Model</b></td>
                            <td style="width: 110px;"><span t-field="o.car_history_id.car_model_id.name"/></td>
                            <td><b>Plate Number</b></td>
                            <td style="width: 110px;"><span t-field="o.car_history_id.plate_number"/></td>
                            <td><b>ODO</b></td>
                            <td style="width: 110px;"><span t-field="o.current_mileage"/></td>
                        </tr>
                    </table>
                    <div style="width: 920px;">
                        <div style="border-bottom: 10px solid red; margin-top:10px; margin-bottom:10px;"></div>
                    </div>
                    
                    <table style="width: 920px;">
                        <thead style="display: table-row-group">
                            <tr>
                                <th style="width: 570px;text-align:center;">ITEM</th>
                                <th style="width: 100px;text-align:center;">QTY</th>
                                <th style="width: 120px;text-align:right;">U. PRICE</th>
                                <!-- <th style="width: 120px;" class="text-center">RT. PRICE</th>-->
                                <th style="width: 120px;text-align:right;">VAT</th>
                                <th style="width: 130px;text-align:right;">TOTAL</th>
                              </tr>
                        </thead>
                        <tbody class="invoice_tbody">
                            <t t-set="current_subtotal" t-value="0"/>
                            <t t-set="lines" t-value="o.invoice_line_ids.sorted(key=lambda l: (-l.sequence, l.date, l.move_name, -l.id), reverse=True)"/>

                            <t t-foreach="lines" t-as="line">
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                                <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                                    <t t-if="not line.display_type" name="account_invoice_line_accountable">
                                        <td name="account_invoice_line_name">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                        <td class="text-center">
                                            <span t-field="line.quantity"/>
                                        </td>
                                        <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span class="text-nowrap" t-field="line.price_unit"/>
                                        </td>
                                        <td t-attf-class="text-right {{ 'd-none d-md-table-cell' if report_type == 'html' else '' }}">
                                            <span t-esc="line.price_total - line.price_subtotal" t-options='{"widget": "float", "precision": 2}'/>
                                        </td>
                                        <td class="text-right o_price_total">
                                            <span class="text-nowrap" t-esc="line.price_total"/>
                                        </td>
                                    </t>
                                    <t t-if="line.display_type == 'line_section'">
                                        <td colspan="99">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                        <t t-set="current_section" t-value="line"/>
                                        <t t-set="current_subtotal" t-value="0"/>
                                    </t>
                                    <t t-if="line.display_type == 'line_note'">
                                        <td colspan="99">
                                            <span t-field="line.name" t-options="{'widget': 'text'}"/>
                                        </td>
                                    </t>
                                </tr>

                                <t t-if="current_section and (line_last or lines[line_index+1].display_type == 'line_section')">
                                    <tr class="is-subtotal text-right">
                                        <td colspan="99">
                                            <strong class="mr16">Subtotal: </strong>
                                            <span t-esc="current_subtotal"/>
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </tbody>
                        <!-- <tbody>
                            <t t-foreach="o.invoice_line_ids" t-as="line">
                                  <tr>
                                      <td style="text-align:left;"><span t-field="line.name"/></td>
                                    <td style="text-align:center;"><span t-field="line.quantity"/></td>
                                    <td style="text-align:right;"><span t-field="line.price_unit"/></td>
                                    <td style="text-align:right;"><span t-esc="line.price_total - line.price_subtotal" t-options='{"widget": "float", "precision": 2}'/></td>
                                    <td style="text-align:right;"><span t-esc="'{:,.2f}'.format(line.price_total)"/></td>
                                </tr>
                            </t>
                        </tbody>-->
                    </table>
                    <div style="width: 920px;">
                        <div style="border-bottom: 10px solid red; margin-top:10px; margin-bottom:10px;"></div>
                    </div>
                    <table style="width:55%;float:left" border="0">
                        <tr>
                            <td style='width:20%; border:none;' class="text-left"><strong>Invoiced Amount in word:</strong></td>
                            <td style='width:35%; border:none;' class="text-left">
                                <span t-esc="o.set_amount_in_words(o.company_id.currency_id, o.amount_total)"/>
                            </td>
                        </tr>
                        <tr>
                            <td style='border:none;' class="text-left"><br></br><strong>Customer Signature:</strong></td>
                            <td style='border:none;' class="text-left"><br></br></td>
                        </tr>
                    </table>
                    
                    <table style="width:40%;float:right">
                        <tr>
                            <td><strong>Sub Total</strong></td>
                            <td style="text-align:right;"><span t-esc="'{:,.2f}'.format(o.amount_untaxed)"/></td>
                        </tr>
                        <tr>
                            <td><strong>Value Added Tax (VAT)</strong></td>
                            <td style="text-align:right;"><span t-esc="'{:,.2f}'.format(o.amount_tax)"/></td>
                        </tr>
                        <tr>
                            <td><strong>Invoiced Total</strong></td>
                            <td style="text-align:right;"><span t-esc="'{:,.2f}'.format(o.amount_total)"/></td>
                        </tr>
                        <t t-if="print_with_payments">
                            <t t-if="o.payment_state != 'invoicing_legacy'">
                                <t t-set="payments_vals" t-value="o.sudo()._get_reconciled_info_JSON_values()"/>
                                <t t-foreach="payments_vals" t-as="payment_vals">
                                    <tr>
                                        <td>
                                            <strong>Payment Received <t t-esc="payment_vals['date']" t-options='{"widget": "date"}'/></strong>
                                        </td>
                                        <td style="text-align:right;">
                                            -<span t-esc="'{:,.2f}'.format(payment_vals['amount'])"/>
                                        </td>
                                    </tr>
                                </t>
                                <t t-if="len(payments_vals) > 0">
                                    <tr class="border-black">
                                        <td><strong>Amount Due</strong></td>
                                        <td style="text-align:right;">
                                            <span t-esc="'{:,.2f}'.format(o.cutomer_amount_due(o.partner_id, o.move_type))"/>
                                            <!-- <span t-esc="'{:,.2f}'.format(o.amount_residual)"/>-->
                                        </td>
                                    </tr>
                                </t>
                            </t>
                        </t>
                    </table>
                    
                    <table style="width: 920px;">
                        <br></br>
                        <tr>
                            <td style='border:none; text-align: left;'>
                                <br></br>
                                <br></br>
                                <p>
                                I hereby authorize the above repair work or (Work that I'm notified about through phone or SMS) and agree Powertech Auto Services shall repair or replace
                                any parts on the vehicle which it determines in its reasonable professional judgment, are necessary to repair the vehicle, along with the necessary material,
                                and here by grant you and/or your employees permission to operate the vehicle on streets, highways or elsewhere for the purpose of testing and inspection.<br/>
                                An express mechanicâ€™s lien is hereby acknowledge on above vehicle to secure the amount of repair thereto. A phone approval is sufficient to carry-on with any
                                repairs or additional work.<br/>
                                The product no carries warranty unless otherwise stated.
                                </p>
                            </td>
                        </tr>
                    </table>
                </div>
            
                <div class="footer">
                    <br></br>
                    <div class="text-center">
                        <img src='/invoice_extend/static/img/footer.png' style="max-height: 130px; max-width: 920px;"/>
                    </div>
                </div>
            </div>
            </xpath>
        </template>
        
        
        <template id="report_invoice_with_payments" inherit_id="account.report_invoice_with_payments">
            <xpath expr='//t[@t-call="account.report_invoice_document"]' position="after">
                <t t-if="o._get_name_invoice_report() == 'invoice_extend.report_invoice_document'"
                    t-call="invoice_extend.report_invoice_document" t-lang="lang"/>
            </xpath>
        </template>

       
    </data>
</odoo>
