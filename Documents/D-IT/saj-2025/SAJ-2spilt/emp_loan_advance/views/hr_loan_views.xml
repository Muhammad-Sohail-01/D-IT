<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<!-- Loan Views -->
    <record id="view_hr_loan_tree" model="ir.ui.view">
        <field name="name">hr.loan.tree</field>
        <field name="model">hr.loan</field>
        <field name="arch" type="xml">
            <tree string="Loans" decoration-info="state == 'draft'" decoration-muted="state in ('cancelled', 'rejected')" decoration-success="state == 'approved'">
                <field name="name"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="loan_type_id"/>
                <field name="loan_amount"/>
                <field name="currency_id"/>
                <field name="installment_count"/>
                <field name="date_request"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- Update Loan Form View -->
	<record id="view_hr_loan_form" model="ir.ui.view">
	    <field name="name">hr.loan.form</field>
	    <field name="model">hr.loan</field>
	    <field name="arch" type="xml">
	        <form string="Loan Request">
	            <header>
	                <button name="action_submit" string="Submit" type="object" class="oe_highlight"
	                    attrs="{'invisible': [('state', '!=', 'draft')]}"/>
	                <button name="action_approve" string="Approve" type="object" class="oe_highlight"
	                    groups="hr_loan.group_loan_manager"
	                    attrs="{'invisible': [('state', '!=', 'submitted')]}"/>
	                <field name="state" widget="statusbar" statusbar_visible="draft,submitted,approved,running,done"/>
	            </header>
	            <sheet>
	                <div class="oe_title">
	                    <h1>
	                        <field name="name" readonly="1"/>
	                    </h1>
	                </div>
	                <group>
	                    <group>
	                        <field name="employee_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                        <field name="department_id" readonly="1"/>
	                        <field name="date_request"/>
	                        <field name="installment_start_date" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                    </group>
	                    <group>
	                        <field name="loan_type_id" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                        <field name="currency_id" options="{'no_create': True}" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                        <field name="loan_amount" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                        <field name="installment_count" attrs="{'readonly': [('state', '!=', 'draft')]}"/>
	                    </group>
	                </group>
	                <notebook>
	                    <page string="Installments" name="installments">
	                        <field name="installment_line_ids" readonly="1">
	                            <tree string="Installments" editable="bottom">
	                                <field name="sequence" widget="handle"/>
	                                <field name="installment_date"/>
	                                <field name="amount"/>
	                                <field name="paid_amount"/>
	                                <field name="state"/>
	                            </tree>
	                        </field>
	                    </page>
	                    <page string="Approvals" name="approvals">
	                        <group>
	                            <group string="Accountant Approval" attrs="{'invisible': [('state', 'not in', ['submitted', 'approved', 'running'])]}">
	                                <field name="accountant_approval_ids" widget="many2many_tags"/>
	                                <field name="accountant_approval_count"/>
	                            </group>
	                            <group string="Finance Approval" attrs="{'invisible': [('state', 'not in', ['submitted', 'approved', 'running'])]}">
	                                <field name="finance_approval_ids" widget="many2many_tags"/>
	                                <field name="finance_approval_count"/>
	                            </group>
	                            <group string="Management Approval" attrs="{'invisible': [('state', 'not in', ['submitted', 'approved', 'running'])]}">
	                                <field name="management_approval_ids" widget="many2many_tags"/>
	                                <field name="management_approval_count"/>
	                            </group>
	                        </group>
	                    </page>
	                </notebook>
	            </sheet>
	            <div class="oe_chatter">
	                <field name="message_follower_ids"/>
	                <field name="activity_ids"/>
	                <field name="message_ids"/>
	            </div>
	        </form>
	    </field>
	</record>

	<!-- Loan Installment Views -->
    <record id="view_hr_loan_installment_tree" model="ir.ui.view">
        <field name="name">hr.loan.installment.tree</field>
        <field name="model">hr.loan.installment</field>
        <field name="arch" type="xml">
            <tree string="Loan Installments" decoration-success="state == 'paid'" decoration-info="state == 'partial'" decoration-danger="state == 'draft'">
                <field name="sequence" widget="handle"/>
                <field name="loan_id"/>
                <field name="installment_date"/>
                <field name="amount"/>
                <field name="paid_amount"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <!-- Search Views -->
    <record id="view_hr_loan_search" model="ir.ui.view">
        <field name="name">hr.loan.search</field>
        <field name="model">hr.loan</field>
        <field name="arch" type="xml">
            <search string="Search Loans">
                <field name="name"/>
                <field name="employee_id"/>
                <field name="department_id"/>
                <field name="loan_type_id"/>
                <separator/>
                <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Submitted" name="submitted" domain="[('state', '=', 'submitted')]"/>
                <filter string="Approved" name="approved" domain="[('state', '=', 'approved')]"/>
                <filter string="Running" name="running" domain="[('state', '=', 'running')]"/>
                <group expand="0" string="Group By">
                    <filter string="Employee" name="employee" context="{'group_by': 'employee_id'}"/>
                    <filter string="Department" name="department" context="{'group_by': 'department_id'}"/>
                    <filter string="Loan Type" name="loan_type" context="{'group_by': 'loan_type_id'}"/>
                    <filter string="Status" name="status" context="{'group_by': 'state'}"/>
                </group>
            </search>
        </field>
    </record>


    <record id="action_hr_loan" model="ir.actions.act_window">
        <field name="name">Loan Requests</field>
        <field name="res_model">hr.loan</field>
        <field name="view_mode">tree,form</field>
        <field name="search_view_id" ref="view_hr_loan_search"/>
        <field name="context">{'search_default_draft': 1}</field>
    </record>

	    <!-- Menus -->
    <menuitem id="menu_hr_loan_root"
        name="Employee Loans"
        parent="account.menu_finance"
        sequence="50"/>

    <menuitem id="menu_hr_loan_request"
        name="Loan Requests"
        parent="menu_hr_loan_root"
        action="action_hr_loan"
        sequence="10"/>

</odoo>